<div class="page-container">
  <header class="page-header">
    <div class="header-left">
      <h1>User Management</h1>
      <p class="subtitle">Invite new users, manage accounts, and review role definitions.</p>
    </div>
  </header>

  <div class="um-grid">
    <!-- Invite User -->
    <mat-card class="card invite-card">
      <div class="card-header">
        <h2>Invite User</h2>
        <span class="descriptor">Send an invitation to staff, billing managers, or auditors.</span>
      </div>

      <form class="invite-form" (ngSubmit)="submitInvite()" #f="ngForm">
        <div class="input-bar">
          <span class="input-icon"><mat-icon>person</mat-icon></span>
          <input type="text" name="name" [(ngModel)]="inviteForm.name" placeholder="Full name" required />
        </div>

        <div class="input-bar">
          <span class="input-icon"><mat-icon>email</mat-icon></span>
          <input type="email" name="email" [(ngModel)]="inviteForm.email" placeholder="Email address" required />
        </div>

        <div class="input-bar role-field">
          <span class="input-icon"><mat-icon>supervisor_account</mat-icon></span>
          <mat-select name="role" [(ngModel)]="inviteForm.role" required panelClass="dept-panel">
            <mat-option *ngFor="let r of roles" [value]="r.value">{{ r.label }}</mat-option>
          </mat-select>
        </div>

        <button class="primary-btn" type="submit" [disabled]="inviting || f.invalid">
          <mat-icon *ngIf="!inviting">person_add</mat-icon>
          <mat-icon *ngIf="inviting">hourglass_empty</mat-icon>
          <span>{{ inviting ? 'Sendingâ€¦' : 'Send Invite' }}</span>
        </button>
      </form>

      <!-- Success banner -->
      <div *ngIf="inviteSuccess" class="success-banner">
        <mat-icon>check_circle</mat-icon>
        Invite sent successfully.
      </div>

      <!-- Error banner -->
      <div *ngIf="inviteError" class="error-banner">
        <mat-icon>error</mat-icon>
        {{ inviteError }}
      </div>
    </mat-card>

    <!-- Role Definitions -->
    <mat-card class="card roles-card">
      <div class="card-header">
        <h2>Role Definitions</h2>
        <span class="descriptor">Roles define what actions users can take in MediAxis.</span>
      </div>
      <div class="role-definitions">
        <div class="role-item">
          <span class="role-chip staff"><mat-icon>person</mat-icon> Staff</span>
          <span class="role-desc">Create & submit claims.</span>
        </div>
        <div class="role-item">
          <span class="role-chip manager"><mat-icon>work</mat-icon> Billing Manager</span>
          <span class="role-desc">Review & resubmit, manage payers.</span>
        </div>
        <div class="role-item">
          <span class="role-chip auditor"><mat-icon>visibility</mat-icon> Auditor</span>
          <span class="role-desc">Read-only access to claims & logs.</span>
        </div>
      </div>
    </mat-card>

    <!-- Accounts Table -->
    <mat-card class="card users-card full-width">
      <div class="card-header">
        <h2>Accounts</h2>
      </div>

      <!-- Toolbar -->
      <div class="toolbar">
        <div class="search-bar">
          <span class="search-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M10 2a8 8 0 105.293 14.293l4.707 4.707 1.414-1.414-4.707-4.707A8 8 0 0010 2zm0 2a6 6 0 110 12A6 6 0 0110 4z" />
            </svg>
          </span>
          <input type="text" [(ngModel)]="searchTerm" placeholder="Search by name, email, role, or status..."
            aria-label="Search users" />
        </div>

        <div class="sort-controls">
          <label>Sort by:</label>
          <button (click)="setSort('name')">Name</button>
          <button (click)="setSort('email')">Email</button>
          <button (click)="setSort('role')">Role</button>
          <button (click)="setSort('status')">Status</button>
          <button (click)="setSort('lastLogin')">Last Login</button>
        </div>
      </div>

      <table mat-table [dataSource]="filteredUsers" class="users-table">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let u">{{ u.name }}</td>
        </ng-container>
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let u">{{ u.email }}</td>
        </ng-container>
        <ng-container matColumnDef="role">
          <th mat-header-cell *matHeaderCellDef>Role</th>
          <td mat-cell *matCellDef="let u">
            <span class="role-badge" [class.manager]="u.role==='billing-manager'" [class.auditor]="u.role==='auditor'">
              {{ roleBadge(u.role) }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let u">
            <span class="status" [class.active]="u.status==='Active'" [class.invited]="u.status==='Invited'"
              [class.suspended]="u.status==='Suspended'">
              {{ u.status }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="last">
          <th mat-header-cell *matHeaderCellDef>Last Login</th>
          <td mat-cell *matCellDef="let u">{{ u.lastLogin }}</td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let u">
            <button mat-icon-button [matMenuTriggerFor]="menu"><mat-icon>more_vert</mat-icon></button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="activate(u)">
                <mat-icon>check_circle</mat-icon><span>Activate</span>
              </button>
              <button mat-menu-item (click)="suspend(u)">
                <mat-icon>pause_circle</mat-icon><span>Suspend</span>
              </button>
              <button mat-menu-item (click)="revoke(u)">
                <mat-icon>block</mat-icon><span>Revoke</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="['name','email','role','status','last','actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['name','email','role','status','last','actions'];"></tr>
      </table>
    </mat-card>
  </div>
</div>